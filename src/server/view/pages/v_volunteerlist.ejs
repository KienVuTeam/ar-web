<style>
  .volunteer-list {
    padding-top: 50px;
    min-height: 500px;
  }
  table {
    text-align: center;
  }
  section.event {
    padding-top: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .event .event-info {
    text-align: center;
  }
  /* / */
  section.marathon {
      width: 100%;
      background: #fff;
    }

    .marathon .banner {
      width: 100%;
      max-height: 380px;
      overflow: hidden;
      position: relative;
    }

    .marathon .banner img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .marathon .content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    .marathon .content h1 {
      font-size: 22px;
      font-weight: bold;
      color: #0a2a66;
      margin-bottom: 15px;
    }

    .marathon .content p {
      font-size: 14px;
      line-height: 1.6;
      color: #444;
    }

    .marathon .event-info {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      color: #666;
      font-size: 14px;
    }

    .marathon .event-info span {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .marathon .content h1 {
        font-size: 18px;
      }

      .marathon .content p {
        font-size: 13px;
      }
      .main-container{
        width: calc(94% - 10px) !important;
      }
    }
</style>
<section class="marathon">
    <!-- Banner -->
    <div class="banner">
      <img src="https://cdn-vietrace365.vn/uploads/f_65dbf8aac26f782ac4075d3b/banner-1800-x-600-20258161512.png" alt="Thaco Chu Lai Half Marathon 2025">
    </div>

    <!-- Content -->
    <div class="content">
      <h1><%=event.name%></h1>
      <p>
        <%=(event.desc && event) ? event.desc : ''%></p>
      </p>

      <!-- Event Info -->
      <div class="event-info">
        <span><% let d = new Date(event.startDate); %>
    
      <%= d.getDate().toString().padStart(2, '0') %>/<%= (d.getMonth() +
      1).toString().padStart(2, '0') %>/<%= d.getFullYear() %>
    </span>-<span><%=event.place%></span>
      </div>
    </div>
  </section>
  <!--  -->


<section class="volunteer-list">
  <div class="main-container">
    <table class="table table-striped" id="volunteer_tbl">
      <thead>
        <th>#</th>
        <th>Name</th>
        <th>Role</th>
        <th>Certificate</th>
      </thead>
      <tbody>
        <% volunteers.forEach((v, index)=>{ %>
        <tr
          data-id="<%=v._id%>"
          data-name="<%=v.fullname%>"
          data-role="<%=v.role%>"
        >
          <td><%=index+1%></td>
          <td><%= v.fullname %></td>
          <td><%=v.role%></td>
          <td><button class="btn btn-outline-success btn-cert">Cert</button></td>
        </tr>
        <%})%>
      </tbody>
    </table>
  </div>
  <input type="hidden" id="ei_hidden" name="" value="<%=event_id%>" />
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // write down
    const navLinks = document.querySelectorAll(".nav-menu a");
  var currentPath = '/volunteer';

  navLinks.forEach((link) => {
    if (link.getAttribute("href") === currentPath) {
      link.classList.add("active");
    } else {
      link.classList.remove("active");
    }
  });
    document
      .querySelectorAll("#volunteer_tbl tbody .btn-cert")
      .forEach((el, i) => {
        el.addEventListener("click", function (ev) {
          const vi = this.closest("tr").getAttribute("data-id");
          const ei = document.getElementById("ei_hidden").value;
          console.log(vi + " | " + ei);
          GetVolunteerCertificate(vi, ei);
        });
      });

    function GetVolunteerCertificate(vol_id, event_id) {
      $.ajax({
        url: `/volunteer/certificate`,
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({
          event_id: event_id,
          volunteer_id: vol_id,
        }),
        success: (res) => {
          $("#certificateModal img").attr("src", res.image);
          $("#certificateModal").modal("show");
          $("#btn-download").attr("href", res.image)

        //   alert("success");
        },
        error: (err) => {
          alert("failed");
        },
      });
    }
  });
</script>


<!-- NEW -->
 <!-- Modal -->
<div class="modal fade" id="certificateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog 	modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <!-- <h5 class="modal-title" id="exampleModalLabel"></h5> -->
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img src="" alt="Certificate Preview" class="img-fluid" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <!-- <button type="button" id="btn-download" download class="btn btn-primary">Download Certificate</button> -->
         <a href="" id="btn-download" download class="btn btn-outline-success">Download certificate</a>
      </div>
    </div>
  </div>
</div>

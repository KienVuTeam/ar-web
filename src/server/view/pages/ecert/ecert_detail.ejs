<style>
  .volunteer-list {
    padding-top: 10px;
    min-height: 500px;
  }
  table {
    text-align: center;
  }
  section.event {
    padding-top: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .event .event-info {
    text-align: center;
  }
  /* / */
  section.marathon {
      width: 100%;
      background: #fff;
    }

    .marathon .banner {
      width: 100%;
      max-height: 380px;
      overflow: hidden;
      position: relative;
    }

    .marathon .banner img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .marathon .content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    .marathon .content h1 {
      font-size: 22px;
      font-weight: bold;
      color: #0a2a66;
      margin-bottom: 15px;
    }

    .marathon .content p {
      font-size: 14px;
      line-height: 1.6;
      color: #444;
    }

    .marathon .event-info {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      color: #666;
      font-size: 14px;
    }

    .marathon .event-info span {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .marathon .content h1 {
        font-size: 18px;
      }

      .marathon .content p {
        font-size: 13px;
      }
      .main-container{
        width: calc(94% - 10px) !important;
      }
    }
    /* ============================
   MOBILE FONT OPTIMIZATION
   ============================ */
@media (max-width: 768px) {

  /* Gi·∫£m c·ª° ch·ªØ b·∫£ng */
  #ecert_tbl_wrapper .dt-top-flex-fix {
    font-size: 12px !important;
  }

  /* Gi·∫£m font c·ªßa select length */
  #ecert_tbl_wrapper .dt-length select {
    font-size: 12px !important;
    padding: 4px 6px !important;
  }

  /* Gi·∫£m font √¥ search */
  #ecert_tbl_wrapper .dt-search input {
    font-size: 12px !important;
    height: 30px !important;
    padding: 4px 8px !important;
  }

  /* Gi·∫£m font trong header */
  #ecert_tbl thead th {
    font-size: 11px !important;
    padding: 10px 5px !important;
  }

  /* Gi·∫£m font body b·∫£ng */
  #ecert_tbl tbody td {
    font-size: 12px !important;
    padding: 6px 4px !important;
  }

  /* N√∫t Ecert */
  #ecert_tbl button {
    font-size: 11px !important;
    padding: 4px 6px !important;
  }

  /* Icon nh·ªè h∆°n */
  #ecert_tbl img.btn-cert {
    width: 22px !important;
    height: 22px !important;
  }
}

    /* css */
    .table-box {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    .table-minimal {
      width: 100%;
      border-collapse: collapse;
    }
    .table-minimal thead {
      background: #f9fafc;
    }
    .table-minimal thead th {
      padding: 14px 16px;
      text-align: center;
      font-size: 13px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
    }
    .table-minimal tbody tr {
      border-bottom: 1px solid #f0f0f0;
      text-align: center;
    }
    .table-minimal tbody td {
      padding: 5px;
      font-size: 15px;
      color: #333;
      vertical-align: middle;
    }
    .table-minimal tbody tr:hover {
      background: #f6faff;
      transition: 0.2s;
    }
    .status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
    }
    .status.active { background: #d1f7d6; color: #1b7a2a; }
    .status.pending { background: #fff3cd; color: #856404; }
    .status.blocked { background: #f8d7da; color: #842029; }
    .table-minimal img.btn-cert{font-size: 5px; height: 26px; width: 26px; }
    .table-minimal img.btn-cert:hover{
      transform: scale(1.2);
    }
    .table-highlight {
  background-color: #f2fdff !important; /* xanh aqua nh·∫°t */
  transition: background-color 0.4s ease;
  /* box-shadow: inset 0 0 0 2px #26c6da; */
}

</style>

<!-- NEW -->
 <!-- Modal -->
<!-- modal  -->
<div class="modal fade" id="certificateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog 	modal-lg">
    <div class="modal-content">
      <div class="modal-body">
        <img src="" alt="Certificate Preview" class="img-fluid" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <!-- <button type="button" id="btn-download" download class="btn btn-primary">Download Certificate</button> -->
         <a href="" id="btn-download" download class="btn btn-outline-success">Download certificate</a>
      </div>
    </div>
  </div>
</div>
<section class="marathon">
    <!-- Banner -->
    <div class="banner">
      <!-- <img src="https://cdn-vietrace365.vn/uploads/f_65dbf8aac26f782ac4075d3b/banner-1800-x-600-20258161512.png" alt="Thaco Chu Lai Half Marathon 2025"> -->
       <!-- <img src="https://cdn-vietrace365.vn/uploads/f_65dbf8aac26f782ac4075d3b/banner-1800-x-600-b-20259161725.png" alt=""> -->
        <%if(cp&&cp.img_thumb){%>
          <img src="<%=cp?.img_thumb%>" alt="">
        <%}else{%>

        <%}%>
    </div>

    <!-- Content -->
    <div class="content">
      <h1><%=cp.title%></h1>
      <!-- <p><small>(ƒê√¢y l√† k·∫øt qu·∫£ s∆° b·ªô, BTC s·∫Ω ti·∫øp t·ª•c th√¥ng b√°o khi c√≥ k·∫øt qu·∫£ ch√≠nh th·ª©c)</small></p> -->
      <p>
        <%=(cp.desc && cp) ? cp?.desc : ''%></p>
      </p>

      <!-- Event Info -->
      <div class="event-info">
        [<span><%# let d = new Date(event.startDate); %>
    
      <%# = d.getDate().toString().padStart(2, '0') %>/<%#= (d.getMonth() +
      1).toString().padStart(2, '0') %>/<%#= d.getFullYear() %>
    </span>-<span><%#event.place%></span>]
      </div>
    </div>
  </section>
  <!--  -->


<section class="volunteer-list">
  
<style>
  .my-table-wraper{
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    margin: 30px 0;
    padding: 10px 20px;
    border-radius: 5px;
    overflow-x: auto;
  }
</style>
    <div class="main-container">
      <div class="my-table-wraper">
      <table class="table-minimal" id="ecert_tbl">
      <thead>
        <th>#</th>
        <th>Name</th>
        <th>Role</th>
        <th>Certificate</th>
      </thead>
      <tbody>
        <%# volunteers.forEach((v, index)=>{ %>
        <tr
        >
          <td><%#=index+1%></td>
          <td><%#= v.fullname %></td>
          <td><%#=v.role%></td>
          <td><img class="btn-cert" src="/icons/icon-cert.ico" alt=""></td>
        </tr>
        <%#})%>
      </tbody>
    </table>
    </div>
  </div>
  <input type="hidden" id="ei_hidden" name="" value="<%#=event_id%>" />
    </div>
</section>
<!-- //=================Script==============// -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // global scope
    const certTbl = document.querySelector('ecert_tbl');
    const temp = '<%=cp.slug%>';
    // var c_id = '68e336e17ff1767a669aa0f6';
    var c_id = '<%=cp.slug%>'
    // 
    const modalRenderCertEl = document.querySelector('#certificateModal');
    const modalRenderCert = new bootstrap.Modal(modalRenderCertEl);
    const navLinks = document.querySelectorAll(".nav-menu a");
  var currentPath = '/e-cert';

  navLinks.forEach((link) => {
    if (link.getAttribute("href") === currentPath) {
      link.classList.add("active");
    } else {
      link.classList.remove("active");
    }
  });
  
    // tbl 
    // global scope
    const myDataTable = new DataTable('#ecert_tbl', {
      processing: true,
      serverSide:true,
      order: [], // üëà T·∫Øt sort m·∫∑c ƒë·ªãnh (kh√¥ng c·ªôt n√†o ƒë∆∞·ª£c sort)
      ajax: {
        url: `/e-cert/data-table/${c_id}`,
        type: 'POST',
        data: function(d){
          return d;
        }
    },
    columns: [
      {data: null, orderable: false, serchable: false, render: (data, type, row, meta)=>meta.row+1},
      {data: 'name', orderable: false},
      {data: 'field_1', orderable: false},
      {data: null, orderable: false, serchable: false,
        render: (data, type, row)=>'<button class="btn btn-outline-info">Ecert</button>'
      }
    ],
    createdRow: function(row, data, dataIndex){
      $(row).attr('data-id', data._id)
    }
    

    });
    // ‚úÖ C√°ch b·∫Øt s·ª± ki·ªán trong DataTables 2.3.4
myDataTable.on('init', function() {
  console.log('‚úÖ DataTable ƒë√£ kh·ªüi t·∫°o xong!');
  // new
  const wrapper = document.querySelector('#ecert_tbl_wrapper');
  if (!wrapper) return;

  const dtLength = wrapper.querySelector('.dt-length');
  const dtSearch = wrapper.querySelector('.dt-search');

  // N·∫øu kh√¥ng c√≥ th√¨ d·ª´ng
  if (!dtLength || !dtSearch) return;

  // T·∫°o wrapper m·ªõi ch·ª©a c·∫£ 2 th√†nh ph·∫ßn
  let topFlex = document.createElement("div");
  topFlex.className = "dt-top-flex-fix";

  // Ch√®n wrapper m·ªõi v√†o ƒë√∫ng v·ªã tr√≠
  dtLength.parentNode.insertBefore(topFlex, dtLength);

  // Nh√©t length + search v√†o trong wrapper m·ªõi
  topFlex.appendChild(dtLength);
  topFlex.appendChild(dtSearch);

  // √âp layout flex
  Object.assign(topFlex.style, {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    width: "100%",
    marginBottom: "10px",
    flexWrap: "nowrap"
  });

  // Thu g·ªçn √¥ search tr√™n mobile
  const input = dtSearch.querySelector("input");
  if (input) {
    input.style.maxWidth = "140px";
    input.style.width = "140px";
  }

  // ·∫®n label length + search
  const lbl1 = dtLength.querySelector("label");
  const lbl2 = dtSearch.querySelector("label");
  if (lbl1) lbl1.style.display = "none";
  if (lbl2) lbl2.style.display = "none";

  // ·∫®n info ph√≠a d∆∞·ªõi
  const info = wrapper.querySelector('.dt-info');
  if (info) info.style.display = "none";
  //old
  document.querySelector('#ecert_tbl_wrapper div.dt-length label').style.display='none';
document.querySelector('#ecert_tbl_wrapper div.dt-search input').placeholder='Name'
  const elSearch = document.querySelector('#ecert_tbl_wrapper div.dt-search label');
  console.log('Ph·∫ßn t·ª≠ t√¨m th·∫•y:', elSearch);
   // X·ª≠ l√Ω l·∫ßn ƒë·∫ßu khi init
    document.querySelector('#ecert_tbl_wrapper div.dt-info').style.display='none'
  if (elSearch) elSearch.style.display = 'none';
  
});
    // 
    // lang nghe sukien click tren row
    document.querySelector('#ecert_tbl tbody').addEventListener('click', (e)=>{
      const tr = e.target.closest('tr');
      if(!tr) return;
      const userId = tr.dataset.id;
      console.log('userId: '+userId)
      renderCert(userId);
    })//
    //render sert
    function renderCert(rowId){
      $.ajax({
        url: `/e-cert/render-cert?cid=${c_id}&uid=${rowId}`,
      method: 'GET',
      xhrFields: {responseType: 'blob'},
      processData: false,
      success: (blob)=>{
        const imgURL = URL.createObjectURL(blob);
        document.querySelector('#certificateModal img').setAttribute('src', imgURL);
         // G·∫Øn v√†o n√∫t Download
      const btn = document.querySelector('#btn-download');
      btn.href = imgURL;
      btn.download = `certificate-${rowId}.png`;  // t√™n file khi t·∫£i xu·ªëng
        modalRenderCert.show();
      },
      error: (xhr, status, err)=>{
        console.log(xhr.responseJSON?.mess||'Server error')
      }
      })
    }

    // end
  });
</script>



